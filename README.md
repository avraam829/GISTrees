# GISTrees

[üì± **–°–∫–∞—á–∞—Ç—å APK (Android)**](https://drive.google.com/file/d/19qOvT1BNHga8mdlgzpWnnBeEq9eRhn9L/view?usp=sharing)  
[üåê **–û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ì–ò–° GISTrees**](https://gistrees.ru/)

> –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + –≤–µ–±-–ì–ò–° –¥–ª—è —Å—ä—ë–º–∫–∏ –¥–µ—Ä–µ–≤—å–µ–≤, –æ—Ñ–ª–∞–π–Ω-–¥–µ—Ç–µ–∫—Ü–∏–∏ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.
<p align="center">
  <a href="https://drive.google.com/file/d/19qOvT1BNHga8mdlgzpWnnBeEq9eRhn9L/view?usp=sharing">
    <img alt="Download APK" src="https://img.shields.io/badge/–°–∫–∞—á–∞—Ç—å-APK-3DDC84?logo=android&logoColor=white">
  </a>
  <a href="https://gistrees.ru/">
    <img alt="Open Web GIS" src="https://img.shields.io/badge/–û—Ç–∫—Ä—ã—Ç—å-–≤–µ–±‚Äì–ì–ò–°-1f6feb?logo=mapbox&logoColor=white">
  </a>
</p>

<p align="center">
  <img alt="Status" src="https://img.shields.io/badge/status-prototype-yellow">
  <img alt="NCNN YOLO" src="https://img.shields.io/badge/YOLOv11-NCNN-blue">
</p>


## –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
---
gistrees/
‚îú‚îÄ gistrees-server/   # backend / –ë–î / API –≤–µ–±-–ì–ò–°
‚îú‚îÄ gistrees-web/      # —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤–µ–±-–ì–ò–°
‚îî‚îÄ README.md          # —ç—Ç–æ—Ç —Ñ–∞–π–ª
---

## –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚ö° **–û—Ñ–ª–∞–π–Ω-–¥–µ—Ç–µ–∫—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** –ø—Ä—è–º–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞).
- üì∑ **–û–±–µ –∫–∞–º–µ—Ä—ã**: –æ—Å–Ω–æ–≤–Ω–∞—è –∏ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω —Ç–∞–ø.
- üîÅ **–†–µ–∂–∏–º—ã –º–æ–¥–µ–ª–µ–π**: `det`, `seg`, `pose` (–º–µ–Ω—é **‚ãÆ** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É).  
  - –î–ª—è –¥–µ—Ä–µ–≤—å–µ–≤ –≤–Ω–µ–¥—Ä—ë–Ω **seg** (—Å–µ–π—á–∞—Å –º–æ–¥–µ–ª—å **nano / n**).  
  - `det`/`pose` ‚Äî –±–∞–∑–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã YOLO –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
- üñº **–§–æ—Ç–æ—Å—ä—ë–º–∫–∞**: –∫–Ω–æ–ø–∫–∞ ¬´–§–æ—Ç–æ¬ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–¥—Ä.
- üóÇ **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è**: –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–Ω–∏–º–∫–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
- üß≠ **EXIF-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**: –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –≥–µ–æ–ø–æ–∑–∏—Ü–∏—è.
- ‚òÅ **–í—ã–≥—Ä—É–∑–∫–∞ –≤ GISTrees**: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –º–æ–¥–µ–ª–∏ ¬´–ø–æ—Ä–æ–¥–∞/–±–æ–ª–µ–∑–Ω–∏¬ª –ø–æ–∫–∞ **–Ω–µ –æ–±—É—á–µ–Ω—ã**; —Å–µ–π—á–∞—Å ‚Äî —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–µ—Ä–µ–≤—å–µ–≤.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APK:  
   **[–°–∫–∞—á–∞—Ç—å GISTrees APK](https://drive.google.com/file/d/19qOvT1BNHga8mdlgzpWnnBeEq9eRhn9L/view?usp=sharing)**  
   –¢—Ä–µ–±—É–µ—Ç—Å—è Android (ARM64), —Ä–∞–∑—Ä–µ—à–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
2. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ **–∫–∞–º–µ—Ä–µ** –∏ **–≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏**.
3. –ß–µ—Ä–µ–∑ –º–µ–Ω—é **‚ãÆ** (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É) –≤—ã–±–µ—Ä–∏—Ç–µ:
   - **–ó–∞–¥–∞—á—É**: `det / seg / pose`
   - **–ú–æ–¥–µ–ª—å**: `n / s / m` (—Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω–∞ `seg_n` –¥–ª—è –¥–µ—Ä–µ–≤—å–µ–≤)
   - **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**: `cpu / gpu` (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é/–æ—Å–Ω–æ–≤–Ω—É—é –∫–∞–º–µ—Ä—É.
5. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –¥–µ—Ä–µ–≤–æ ‚Äî —É–≤–∏–¥–∏—Ç–µ –º–∞—Å–∫—É/–±–æ–∫—Å—ã/—Å–∫–µ–ª–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
6. –ù–∞–∂–º–∏—Ç–µ **–§–æ—Ç–æ** ‚Äî —Å–Ω–∏–º–æ–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (EXIF + JSON).
7. –û—Ç–∫—Ä–æ–π—Ç–µ **–ì–∞–ª–µ—Ä–µ—é** (–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å), —á—Ç–æ–±—ã:
   - –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–¥—Ä—ã –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ,
   - **–≤—ã–≥—Ä—É–∑–∏—Ç—å** —Å–Ω–∏–º–∫–∏ –≤ GISTrees (–∫–Ω–æ–ø–∫–∞ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É).

---

## –ö–∞–∫–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

–í **EXIF / UserComment (JSON)** –ø–∏—à—É—Ç—Å—è:
- –ü–∞–π–ø–ª–∞–π–Ω (`yolo11`), **task / model / device**, —Ä–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞, —Ñ–ª–∞–≥ –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è, **–≤—Ä–µ–º—è**.
- –°–ø–∏—Å–æ–∫ **–¥–µ—Ç–µ–∫—Ü–∏–π**: –∫–ª–∞—Å—Å (—Å —É—á—ë—Ç–æ–º `labels/*.txt`), –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–æ–∫—Å–∞/–º–∞—Å–∫–∏.
- **GPS** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã).

–≠—Ç–∏ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ–±-–ì–ò–° –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏.

---

## –í–µ–±-–ì–ò–° GISTrees ‚Äî –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ

- üì¶ –°–Ω–∏–º–∫–∏ –ø–∏—à—É—Ç—Å—è –≤ –±–∞–∑—É —Å **—É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏** ‚Äî **–¥—É–±–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã**.
- üó∫ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ **–∫–∞—Ä—Ç–µ** –ø–æ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ –∫–∞–¥—Ä–∞.
- üñº –†–∞–∑–¥–µ–ª **¬´–ì–∞–ª–µ—Ä–µ—è¬ª**: –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–Ω–∏–º–∫–æ–≤ –∏ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–∫—Ç–æ —Å–Ω–∏–º–∞–ª ‚Äî —Å–µ–π—á–∞—Å ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞; –¥–∞–ª–µ–µ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏).
- üß™ **–ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)**:
  - –∑–∞–ø—É—Å–∫ ¬´—Ç—è–∂—ë–ª—ã—Ö¬ª –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º –Ω–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ,
  - —Ä–∞–∑–¥–µ–ª **¬´–û–±—Ä–∞–±–æ—Ç–∫–∞¬ª** –¥–ª—è –ø–æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞.

–û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ì–ò–°:  
**https://gistrees.ru/**

---

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
- –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π **–ø–æ—Ä–æ–¥** –∏ **–±–æ–ª–µ–∑–Ω–µ–π** (–¥–µ—Ç–µ–∫—Ü–∏—è/—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è).
- –£–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ (–∫—Ä—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏, TTA).
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **–ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥** –≤ –≤–µ–±-–ì–ò–°.
- –£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤.
- –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤ –∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.
- –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤—ã—Ö –∫–∞—Ä—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–Ω–µ–Ω–∏–π –ø–æ –ø—Ä–∏–∑–Ω–∞–∫—É
---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

> –ü–∞–π–ø–ª–∞–π–Ω: **Android (CameraX ‚Üí JNI ‚Üí NCNN YOLOv11)** ‚Üí **EXIF (JSON + GPS)** ‚Üí **Upload ‚Üí Flask API** ‚Üí **PostgreSQL + PostGIS + —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Üí **Next.js + Mapbox GL**.

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ | –ö–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏ |
|---|---|---|
| –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | Android (Java), CameraX, ExifInterface, MediaStore | –†–µ–∞–ª—å–Ω–∞—è-–≤—Ä–µ–º—è –¥–µ—Ç–µ–∫—Ü–∏—è/—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è/–ø–æ–∑—ã, –∑–∞–ø–∏—Å—å EXIF+JSON, –ª–æ–∫–∞–ª—å–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è –∏ –≤—ã–≥—Ä—É–∑–∫–∞ –≤ –ì–ò–° |
| –ù–∞—Ç–∏–≤–Ω—ã–π ML | C++17, **ncnn**, (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Vulkan, OpenCV (core) | –ò–Ω—Ñ–µ—Ä–µ–Ω—Å YOLOv11 det/seg/pose/cls/obb, —Ä–∞–±–æ—Ç–∞ —Å .param/.bin, –≤–æ–∑–≤—Ä–∞—Ç –º–∞—Å–æ–∫/–∫–µ–π–ø–æ–∏–Ω—Ç–æ–≤ |
| Backend API | **Flask**, **gunicorn**, **flask-cors**, **psycopg2-binary**, **Pillow** | –ü—Ä–∏—ë–º —Ñ–∞–π–ª–æ–≤, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ SHA-256, –ø–∞—Ä—Å–∏–Ω–≥ EXIF‚ÜíGPS, –∑–∞–ø–∏—Å—å –≤ **PostgreSQL+PostGIS**, —Ä–∞–∑–¥–∞—á–∞ JPEG, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ bbox, —É–¥–∞–ª–µ–Ω–∏–µ |
| –í–µ–±-–ì–ò–° | **Next.js 15** (React 19), **react-map-gl**, **mapbox-gl 2.15**, **@turf/turf** | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ—á–µ–∫, –ø–æ–ø–∞–ø—ã —Å–æ —Å–Ω–∏–º–∫–∞–º–∏, —É–¥–∞–ª–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å—ã –≤ API, –∫–∞—Ä—Ç–∞ |

---

### üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–æ–Ω-–¥–µ–≤–∞–π—Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å)

- **CameraX**: –ø—Ä–µ–≤—å—é + `ImageAnalysis` (YUV_420_888) ‚Üí –ø–µ—Ä–µ–¥–∞—á–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–µ–π –≤ JNI.
- **JNI/NDK**: –≤—ã–∑–æ–≤ `libyolo11ncnn.so`:
  - `loadModel(AssetManager, task, model, device)` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ `.param/.bin` –∏–∑ `assets`.
  - `detectYuv420(...)` / `detectBitmap(...)` ‚Äî –∏–Ω—Ñ–µ—Ä–µ–Ω—Å.
- **–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏** (–º–µ–Ω—é **‚ãÆ**): `task = det/seg/pose/cls/obb`, `model = n/s/m`, `device = cpu/gpu`.
- **LabelStore**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –º–µ—Ç–æ–∫ `assets/labels/<task>_<model>.txt` (–∫–µ—à–∏—Ä—É–µ—Ç—Å—è).
- **–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–æ–∑–∞**: –Ω–∞—Ç–∏–≤–Ω—ã–π –∫–æ–¥ –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ callbacks ‚Üí `SegStore` / `PoseStore`; —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –º–∞—Å–æ–∫/—Å–∫–µ–ª–µ—Ç–æ–≤ –ø–æ–≤–µ—Ä—Ö –ø—Ä–µ–≤—å—é.
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤**:
  - –î–µ–ª–∞–µ—Ç—Å—è **–¥–≤–µ –∫–æ–ø–∏–∏**: *RAW* (`Pictures/GISTreesRaw/‚Ä¶`) –∏ *ANNOTATED* (`Pictures/GISTrees/‚Ä¶`).
  - –í `EXIF:UserComment` –ø–∏—à–µ—Ç—Å—è **JSON**: `{meta{pipeline, task, model, device, srcW/H, mirrorX, ts}, detections[...]}`
  - GPS –ø–∏—à–µ—Ç—Å—è/—á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ExifInterface`; –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ñ–æ—Ä–º–æ–π.
- **–ì–∞–ª–µ—Ä–µ—è**: –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ + **–º–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** –≤ —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ `UploadRepository`).

---

### üß† –ù–∞—Ç–∏–≤–Ω—ã–π —Å–ª–æ–π (C++ / ncnn)

- –ë–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å `YOLO11` + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `YOLO11_det/seg/pose/cls/obb`.
- –ó–∞–≥—Ä—É–∑–∫–∞: `yolo11.load_param(...); yolo11.load_model(...);` (–≤ —Ç.—á. `AAssetManager`), –æ–ø—Ü–∏—è `use_vulkan_compute`.
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  - **Det** ‚Äî bbox+class+score,
  - **Seg** ‚Äî bbox + `mw √ó mh` –±–∏–Ω–∞—Ä–Ω–∞—è –º–∞—Å–∫–∞,
  - **Pose** ‚Äî bbox + –º–∞—Å—Å–∏–≤ `x,y,score` –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ç–æ—á–∫–∞–º.
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç-—Å–∞–π–∑–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ C++ (`set_det_target_size`).

---

### üóÑ Backend API (Flask + PostGIS)

- –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–µ: **gunicorn** (+ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ nginx). CORS –æ—Ç–∫—Ä—ã—Ç –¥–ª—è `/api/*`.
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤**: —à–∞—Ä–¥–∏–Ω–≥ –ø–æ SHA-256  
  `UPLOAD_ROOT/aa/bb/<sha>.jpg` (—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –ø—Ä–∞–≤–∞ `0640`).
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: —Å–µ—Ä–≤–µ—Ä —Å—á–∏—Ç–∞–µ—Ç SHA-256; –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ –∫–ª—é—á –∏ –∞–ø–¥–µ–π—Ç–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
- **EXIF ‚Üí GPS**: `Pillow` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –ø—Ä–∏—Å–ª–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–æ–π.
- **–ë–∞–∑–∞**: PostgreSQL + **PostGIS** (`geography` SRID=4326). –ì–µ–æ–º–µ—Ç—Ä–∏—è –ø–∏—à–µ—Ç—Å—è –∫–∞–∫ `ST_SetSRID(ST_MakePoint(lon,lat),4326)::geography`.  
  JSON –∏–∑ `UserComment` –∫–ª–∞–¥—ë—Ç—Å—è —á–µ—Ä–µ–∑ `psycopg2.extras.Json`.
- **–≠–Ω–¥–ø–æ–π–Ω—Ç—ã**:
  - `GET /api/v1/health` ‚Äî ping.
  - `POST /api/v1/photos` ‚Äî –ø—Ä–∏—ë–º —Ñ–∞–π–ª–∞. **Form-data**:
    - `file` *(jpeg)*, `content_sha256` *(–æ–ø—Ü.)*, `device_id` *(–æ–ø—Ü.)*,
    - `exif_user_comment` *(JSON –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞)*, `shot_time` *(ISO/EXIF)*,
    - `lat`, `lon` *(–æ–ø—Ü.)*.
    - **–û—Ç–≤–µ—Ç**: `{id, sha256, existed, lat, lon, has_geom}`.
  - `GET /api/v1/photos?limit=1000&bbox=minLon,minLat,maxLon,maxLat` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ —Å `image_url`.
  - `GET /api/v1/photos/<sha>.jpg` ‚Äî –æ—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–∞.
  - `DELETE /api/v1/photos/<sha>` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î –∏ –¥–∏—Å–∫–∞.
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
  - `UPLOAD_ROOT=/var/lib/gistrees/uploads`
  - `DATABASE_URL=postgresql://user:pass@host:5432/db` *(–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ `db.py` –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)*

---

### üó∫ –í–µ–±-–ì–ò–° (Next.js + Mapbox GL)

- **Next.js 15** (React 19, Turbopack).  
- **–ö–∞—Ä—Ç–∞**: `react-map-gl` + `mapbox-gl 2.15` + `@turf/turf`.
- **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è**: —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ `ClusterLayers` (–∫–ª–∞—Å—Ç–µ—Ä—ã/—Å—á—ë—Ç—á–∏–∫–∏/–Ω–µ-–∫–ª–∞—Å—Ç–µ—Ä—ã).  
  –ö–ª–∏–∫ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É ‚Äî **expand zoom**, –ø–æ —Ç–æ—á–∫–µ ‚Äî **Popup** —Å –ø—Ä–µ–≤—å—é –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.
- **–†–∞–±–æ—Ç–∞ —Å API**:
  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ—á–µ–∫: `GET /api/v1/photos` (—Å `bbox` –∏ `limit`).
  - –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ø–æ–ø–∞–ø–∞: `DELETE /api/v1/photos/:sha` ‚Üí –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è (`removeBySha`).
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
  - `NEXT_PUBLIC_MAPBOX_TOKEN=‚Ä¶`  
  - (–æ–ø—Ü.) `API_BASE`, –µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –∏ API –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∑–æ–≤—ã –∏–¥—É—Ç –Ω–∞ `/api/*` —Ç–æ–≥–æ –∂–µ —Ö–æ—Å—Ç–∞ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å nginx-–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º).

---

### üîê –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –í–∞–ª–∏–¥–∞—Ü–∏—è SHA (`[0-9a-f]{64}`), –ø—Ä–æ–≤–µ—Ä–∫–∞ `bbox`, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `limit ‚â§ 5000`.
- –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ISO –∏ EXIF-—Ñ–æ—Ä–º–∞—Ç (`YYYY:MM:DD HH:MM:SS`).
- –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É ‚Üí –ª–µ–≥–∫–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å.
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç–æ–∫: —Ä–∞–∑–Ω—ã–µ `labels/*.txt` –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É/–≤–∞—Ä–∏–∞–Ω—Ç –º–æ–¥–µ–ª–∏.

---

## –°—Å—ã–ª–∫–∏

- üì± APK: **https://drive.google.com/file/d/19qOvT1BNHga8mdlgzpWnnBeEq9eRhn9L/view?usp=sharing**  
- üåê –í–µ–±-–ì–ò–°: **https://gistrees.ru/**  
- üìë –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è: *(–¥–æ–±–∞–≤–∏–º —Å—Å—ã–ª–∫—É –ø–æ–∑–∂–µ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ)*

---
